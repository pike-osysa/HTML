(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["92184"],{454387:function(e,t,i){i.r(t),i.d(t,{default:()=>r});let n={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoWithContextLogging_pin",selections:[{args:null,kind:"FragmentSpread",name:"VideoWrapper_pin"}],type:"Pin",abstractKey:null};n.hash="93ed23334d5bac81ac8410f05c4f2031";let r=n},111923:function(e,t,i){i.d(t,{Z:()=>p});var n=i(581722),r=i(575108),a=i(105433),o=i(542092),d=i(611134),l=i(189976),s=i(800300),h=i(696323);let u={[o.o.aggregatedComment]:"AggregatedCommentReplyResource",[o.o.pin]:"AggregatedCommentResource",[o.o.didIt]:"DidItCommentsResource"};function p(){let e=(0,n.I0)(),{aggregatedCommentCreated:t,updateCommentCount:i}=(0,a.nf)();return async({commentMedia:n,force:a=!0,fromUnifiedComment:o,objectId:p,objectType:c,orbacSubjectId:m,pinId:g,replyToCommentId:v,tags:T,text:f})=>{let E=u[c],y={force:a,objectId:p,pinId:g,tags:T,text:f,replyToCommentId:v,...m?{orbacSubjectId:m}:{},...n?{commentMedia:n}:{}},_=h.Z.AGGREGATED_COMMENTS;o&&(_="pin"===c?h.Z.UNIFIED_COMMENTS:h.Z.AGGREGATED_COMMENT_REPLIES);let I=await r.Z.create(E,y).callCreate({showError:!1}),D=I.resource_response.data;return t(p,D),e((0,l.vX)({feedType:_,feedId:p,itemIds:[D.id],itemType:D.type,prepend:!0})),"aggregatedComment"===c?i(p,1):"pin"!==c&&e((0,d.L8)(p,1)),g&&e((0,s.R)(g,1)),D.id||I}}},707915:function(e,t,i){i.d(t,{Z:()=>d});var n=i(667294),r=i(883119),a=i(747859),o=i(785893);let d=(0,n.forwardRef)(({accessibilityLabel:e,handleClick:t,icon:i,iconColor:d,iconOnly:l,testId:s,buttonText:h,tabIndex:u,bgColor:p,isActive:c},m)=>{let[g,v]=(0,n.useState)(!1),T=(0,n.useRef)(null);(0,n.useImperativeHandle)(m,()=>T.current);let{setAbortNoActionPlacementTimeout:f}=(0,a.x4)(),E=()=>{v(e=>!e),t(),f(!0)},y=e=>{T&&e.target instanceof Element&&!T.current?.contains(e.target)&&v(!1)};return(0,n.useEffect)(()=>(window.addEventListener("mousedown",y),()=>{window.removeEventListener("mousedown",y)}),[]),(0,n.useEffect)(()=>{void 0!==c&&v(c)},[c]),(0,o.jsx)(r.xu,{"data-test-id":s||"closeup-action-bar-button",children:(0,o.jsxs)(r.kC,{alignItems:"center",justifyContent:"start",children:[(0,o.jsx)(r.hU,{ref:T,accessibilityLabel:e,bgColor:p,icon:i,iconColor:d||"darkGray",onClick:E,selected:g,size:l?"md":"lg",tabIndex:u}),h&&(0,o.jsx)(r.iP,{onTap:E,rounding:2,children:(0,o.jsx)(r.X6,{color:"light",overflow:"normal",size:"400",children:h})})]})})})},149026:function(e,t,i){i.d(t,{Z$:()=>o,by:()=>d,eL:()=>a});var n=i(469987),r=i(941404);let a=e=>{if("undefined"==typeof window)return"";let t=0,i=document.querySelector('[data-test-id="header"]');if(null!==i){let{height:e}=i.getBoundingClientRect();t+=e}switch(e){case"AuthHomefeed":let n=document.querySelector('[data-root-margin="more-ideas-tabs"]');if(null!==n){let{height:e}=n.getBoundingClientRect();t+=e}break;case"SearchItem":let r=document.querySelector('[data-root-margin="search-improvements-bar"]');if(null!==r){let{height:e}=r.getBoundingClientRect();t+=e}let a=document.querySelector('[data-test-id="search-tab-bar"],[data-root-margin="search-one-bar"]');if(null!==a){let{height:e}=a.getBoundingClientRect();t+=e}}return`${-1*t}px 0px 0px 0px`},o=({videosDuration:e,vHLSV4VideoDuration:t,storyPinDataTotalVideoDuration:i})=>(0,n.Z)(e||t||i||0),d=(e,t,i)=>{e?(0,r.My)(`${t}.mute_button.toggle_off`):(0,r.My)(`${t}.mute_button.toggle_on`),i({action:"click",item:"mute-button"})}},542092:function(e,t,i){i.d(t,{n:()=>r,o:()=>n});let n={aggregatedComment:"aggregatedComment",didIt:"didIt",pin:"pin"},r={aggregatedComment:"aggregatedcomment",didIt:"userdiditdata",pin:"pin"}},611134:function(e,t,i){i.d(t,{Th:()=>m,IU:()=>c,L8:()=>h,wH:()=>d,lg:()=>p,DD:()=>u,YH:()=>l});var n=i(575108),r=i(686319),a=i(189976),o=i(696323);function d({didItDataId:e,isLikedByMe:t,orbacSubjectId:i}){return n=>((0,r.Z)({url:`/v3/did_it/${e}/like/`,method:t?"DELETE":"POST",data:i?{orbac_subject_id:i}:{}}),n({type:"USER_DID_IT_DATA_LIKE_TOGGLED",payload:{id:e,liked_by_me:!t}}))}function l({didItDataId:e,isMarkedHelpfulByMe:t,orbacSubjectId:i}){return n=>((0,r.Z)({url:`/v3/helpful/2/${e}/`,method:t?"DELETE":"POST",data:i?{orbac_subject_id:i}:{}}),n({type:"USER_DID_IT_DATA_HELPFUL_TOGGLED",payload:{id:e,marked_helpful_by_me:!t}}))}function s(e){return{type:"USER_DID_IT_DATA_DELETE",payload:{id:e}}}function h(e,t){return{type:"USER_DID_IT_DATA_UPDATE_COMMENT_COUNT",payload:{id:e,increment:t}}}function u({aggregatedPinDataId:e,details:t,fromUnifiedComment:i,image_signatures:r,pin_id:d,username:l,updateParentDidItCount:s}){let u={aggregatedPinDataId:e,details:t,image_signatures:r,pin_id:d};return t=>n.Z.create("DidItActivityResource",u).callCreate().then(n=>{let r=n.resource_response.data;t({type:"PIN_DID_IT",payload:{id:d,value:!0}}),t({type:"USER_DID_IT_DATA_CREATE",payload:{user_did_it_data:r}}),t((0,a.vX)({feedId:e,feedType:i?o.Z.UNIFIED_COMMENTS:o.Z.TRIED_IT_FEED,itemIds:[r.id],itemType:r.type})),t((0,a.vX)({feedId:l,feedType:o.Z.TRIED_IT_FEED,itemIds:[r.id],itemType:r.type})),s&&t(h(e,1))},()=>{})}function p({aggregatedPinDataId:e,feedType:t,id:i,isOwnedByMe:r,pinId:d,username:l,updateParentDidItCount:u}){return p=>{n.Z.create("DidItActivityResource",{user_did_it_data_id:i,pinId:d}).callDelete().then(()=>{r&&p({type:"PIN_DID_IT",payload:{id:d,value:!1}}),p(s(i)),p((0,a.EX)({feedId:e??"",feedType:t||o.Z.TRIED_IT_FEED,itemIds:[i],itemType:"userdiditdata"})),p((0,a.EX)({feedId:l,feedType:o.Z.TRIED_IT_FEED,itemIds:[i],itemType:"userdiditdata"})),p((0,a.EX)({feedId:l,feedType:o.Z.UNIFIED_COMMENTS,itemIds:e?[e]:[],itemType:"userdiditdata"})),u&&p(h(i,-1))},()=>{})}}function c({id:e,details:t,image_signatures:i,pinId:r}){let a={details:t,image_signatures:i,user_did_it_data_id:e,pin_id:r};return e=>{n.Z.create("DidItActivityResource",a).callUpdate().then(t=>{e({type:"USER_DID_IT_DATA_UPDATE",payload:{user_did_it_data:t.resource_response.data}})},()=>{})}}function m(e,t,i,n,d){return l=>{(0,r.Z)({url:`/v3/did_it/${i}/flag/`,method:"PUT",data:{reason:n,detailed_reasons:t,explanation:void 0}}).then(()=>{l(s(i)),e&&l((0,a.EX)({feedId:e,feedType:o.Z.TRIED_IT_FEED,itemIds:[i],itemType:"userdiditdata"})),l((0,a.EX)({feedId:d,feedType:o.Z.TRIED_IT_FEED,itemIds:[i],itemType:"userdiditdata"}))},()=>{})}}},800300:function(e,t,i){i.d(t,{R:()=>n});function n(e,t){return{type:"PIN_UPDATE_COMMENT_COUNT",payload:{id:e,increment:t}}}},720445:function(e,t,i){i.d(t,{ZP:()=>C});var n,r=i(667294);i(422578);var a=i(883119),o=i(980787),d=i(289032),l=i(779548),s=i(115247),h=i(274320),u=i(149026),p=i(792171),c=i(589357),m=i(78762),g=i(785893);function v(e,t,i){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?n:n+"")in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let T=(0,m.Z)(()=>Promise.all([i.e("25418"),i.e("22244"),i.e("77779"),i.e("31142")]).then(i.bind(i,509691)),void 0,e=>509691,"app-www-video-VideoWrapper"),f=[0,.25,.5,.75,.95,.97],E=[0,.5,.8,.99,1],y={rootMargin:"-64px 0px 0px 0px",threshold:[...c.iM]},_=Object.freeze({LOADING:0,PLAYING:1,PAUSED:2,STALLING:3}),I=void 0!==n?n:n=i(454387);function D(){return new Date().getTime()}function w(e){return!!e.volume&&e.volume>0}class b extends r.Component{constructor(e){super(e),v(this,"videoWrapperRef",(0,r.createRef)()),v(this,"handleWindowResize",()=>{if(!this.fullscreen){let e=this.getDimensions(),{height:t,width:i}=this.currentInterval;e.height!==t||e.width!==i?this.startNewInterval(e):(this.currentInterval.windowHeight=e.windowHeight,this.currentInterval.windowWidth=e.windowWidth)}}),v(this,"handlePlayheadDown",({event:e})=>{let{onPlayheadDown:t}=this.props;this.setState({seeking:!0}),t&&t({event:e})}),v(this,"handlePlayheadUp",({event:e})=>{let{onPlayheadUp:t}=this.props;this.setState({seeking:!1}),t&&t({event:e})}),v(this,"handleLoop",()=>{this.videoTime=0}),v(this,"handlePlaying",e=>{this.logVideoStart(),this.props.onPlaying&&this.props.onPlaying(e)}),v(this,"handleTimeChange",e=>{let{seeking:t,ready:i}=this.state;if(!this.currentInterval.videoDuration)return;let n=1e3*e.time,r=function(e,t,i,n){if(e>t||i<=0)return null;for(let r of n){let n=r*i;if(e<=n&&t>n)return r}return null}(this.videoTime,n,this.currentInterval.videoDuration,f);if("number"==typeof r&&this.props.playing&&!t&&i){if(this.props.isMetricThrottleExpEnabled&&!this.isVideoEventLogIntervalMet("currentTime"))return;let e=D();this.logVideoEvent(6906,{...this.currentInterval,startTime:e,endTime:e,videoStartTime:0,videoEndTime:0,quartile:Math.floor(4*r),quartilePercentValue:r})}this.videoTime=n,this.props.onTimeChange&&this.props.onTimeChange(e)}),v(this,"handleDurationChange",e=>{this.currentInterval.videoDuration=1e3*e.duration,this.props.onDurationChange&&this.props.onDurationChange(e)}),v(this,"handleReady",e=>{let{ready:t}=this.state;t||this.setState({ready:!0}),this.props.onReady&&this.props.onReady(e),this.resetLastLoggedTime()}),v(this,"handleEnded",e=>{(!this.props.isMetricThrottleExpEnabled||this.isVideoEventLogIntervalMet("endTime"))&&(this.logFourthQuartileEvent(),this.props.loop&&(this.startNewInterval(),this.currentInterval.videoStartTime=0),this.props.onEnded&&this.props.onEnded(e))}),v(this,"handleVisibilityChange",e=>{if(0===e.length)return;let t=function(e){for(let t=0;t<E.length;t+=1){let i=E[t],n=E[t+1];if(null==n||i<=e&&e<n)return i}return null}(Number.parseFloat(e.slice(-1)[0].intersectionRatio.toFixed(2)));"number"==typeof t&&(this.visible=t>=.5),null==t||t===this.currentInterval.viewability||this.fullscreen||(0===t?this.startNewInterval({viewability:t,playbackState:_.PAUSED}):this.startNewInterval({viewability:t}))}),v(this,"handleFullscreenChange",({event:e,fullscreen:t})=>{if(t){let{height:e,width:t}=window.screen;this.startNewInterval({height:e,width:t,windowHeight:e,windowWidth:t})}else t||this.startNewInterval(this.getDimensions());this.fullscreen=t,this.props.onFullscreenChange&&this.props.onFullscreenChange({event:e,fullscreen:t})}),v(this,"handleClose",()=>{this.startNewInterval()}),this.state={ready:!1,seeking:!1,started:!1};let t=D();this.handleWindowResize=(0,d.Z)(this.handleWindowResize,1e3),this.currentInterval={videoDuration:0,startTime:t,endTime:t,videoStartTime:0,videoEndTime:0,isAudible:w(e),playbackState:this.getPlaybackState(e,this.state),quartile:-1,quartilePercentValue:0,height:null,width:null,windowHeight:null,windowWidth:null,viewability:null},this.videoTime=0,this.fullscreen=!1,this.visible=null,this.lastLoggedTime={startTime:0,endTime:0,currentTime:0}}componentDidMount(){this.currentInterval={...this.currentInterval,...this.getDimensions()},window.addEventListener("resize",this.handleWindowResize),window.addEventListener("beforeunload",this.handleClose)}componentDidUpdate(e,t){let i={};w(e)&&!w(this.props)?i.isAudible=!1:!w(e)&&w(this.props)&&(i.isAudible=!0);let n=this.getPlaybackState(this.props,this.state);this.getPlaybackState(e,t)!==n&&(i.playbackState=n),Object.keys(i).length>0&&this.startNewInterval(i)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("beforeunload",this.handleClose),this.startNewInterval()}getPlaybackState(e,t){return t.ready?e.playing&&!t.seeking?_.PLAYING:_.PAUSED:_.LOADING}getDimensions(){let e,t;if(this.videoWrapperRef.current){let i=this.videoWrapperRef.current;i.clientHeight&&i.clientWidth&&(e=i.clientHeight,t=i.clientWidth)}return{height:e,width:t,windowHeight:window.innerHeight,windowWidth:window.innerWidth}}isVideoEventLogIntervalMet(e){let t=D();return!(250>Math.abs(t-this.lastLoggedTime[e]))&&(this.lastLoggedTime[e]=t,!0)}resetLastLoggedTime(){this.lastLoggedTime={startTime:0,endTime:0,currentTime:0}}logVideoEvent(e,t){let{closeupStoryPinViewability:i,contextLogData:n,logContextEvent:r,playing:a,surface:o}=this.props,{seeking:d}=this.state,{height:l,width:s,windowHeight:h,windowWidth:u,viewability:p,...c}=t;if(null!=l&&null!=s&&null!=h&&null!=u&&null!=p){let t={...c,gridAutoplay:6904===e&&a&&!d&&("AuthHomefeed"===o||"SearchItem"===o||"RelatedPinGrid"===o||"PdpRelatedPinGrid"===o),height:l,width:s,windowHeight:h,windowWidth:u,viewability:i||p};r({event_type:e,...function(e){let{eventData:{videoEvent:{gridAutoplay:t,videoDuration:i,startTime:n,endTime:r,videoStartTime:a,videoEndTime:o,isAudible:d,height:l,width:s,playbackState:h,quartile:u,quartilePercentValue:p,windowHeight:c,windowWidth:m,viewability:g}},component:v,objectId:T,view:f,viewParameter:E,...y}=e;return{component:v,object_id_str:T,view_type:f,view_parameter:E,aux_data:{...y},event_data:{videoEventData:{gridAutoplay:t,videoDuration:i?Math.floor(i):0,time:n,endTime:r,videoTime:a?Math.floor(a):0,endVideoTime:o?Math.floor(o):0,isAudible:d,height:l,width:s,playbackState:h,quartile:u,quartilePercentValue:p,windowHeight:c,windowWidth:m,viewability:g}}}}({...n,view:this.fullscreen?108:n.view,eventData:{videoEvent:t}})})}}logFourthQuartileEvent(){let e=D();this.logVideoEvent(6906,{...this.currentInterval,startTime:e,endTime:e,videoStartTime:0,videoEndTime:0,quartile:4,quartilePercentValue:1})}logVideoStart(){if(this.state.started)return;let{contextLogData:e,setVideoPlayed:t,shouldLogVideoStart:i}=this.props;if(i){let e=D();this.logVideoEvent(3621,{...this.currentInterval,startTime:e,endTime:e,videoEndTime:this.videoTime})}t(e.objectId),this.setState({started:!0})}startNewInterval(e){if(this.props.isMetricThrottleExpEnabled&&!this.isVideoEventLogIntervalMet("startTime"))return;let t=D();this.logVideoEvent(6904,{...this.currentInterval,endTime:t,videoEndTime:this.videoTime}),this.currentInterval={...this.currentInterval,...e,startTime:t,videoStartTime:this.videoTime,endTime:-1,videoEndTime:-1},this.resetLastLoggedTime()}render(){let{rootMargin:e,surface:t,aspectRatio:i,backgroundColor:n,captions:r,contextLogData:o,controls:d,fallback:l,hlsConfig:h,isAutoPlay:p,loop:c,objectFit:m,onLoadedChange:v,onControlsPause:f,onControlsPlay:E,onSeek:_,onVolumeChange:I,pin:D,playbackRate:w,playing:b,playsInline:C,poster:L,preload:P,seekTime:R,src:S,videoStartTime:A,volume:N,video:M,variant:x}=this.props,{seeking:U}=this.state;return void 0!==e&&(y.rootMargin=t?(0,u.eL)(t):e),(0,g.jsx)(s.Z,{onVisibilityChange:this.handleVisibilityChange,options:y,children:e=>(0,g.jsx)(a.xu,{ref:t=>{e.current=t,this.videoWrapperRef.current=t},height:"inherit",children:(0,g.jsx)(T,{aspectRatio:i,backgroundColor:n,captions:r,contextLogData:o,controls:d,fallback:l,hlsConfig:h,isAutoPlay:p,loop:c,objectFit:m,onControlsPause:f,onControlsPlay:E,onDurationChange:this.handleDurationChange,onEnded:this.handleEnded,onFullscreenChange:this.handleFullscreenChange,onLoadedChange:v,onLoop:this.handleLoop,onPlay:()=>{},onPlayError:()=>{},onPlayheadDown:this.handlePlayheadDown,onPlayheadUp:this.handlePlayheadUp,onPlaying:this.handlePlaying,onReady:this.handleReady,onSeek:_,onTimeChange:this.handleTimeChange,onVolumeChange:I,pinKey:D,playbackRate:w,playing:!U&&b,playsInline:C,poster:L,preload:P,seekTime:R,src:S,variant:x,video:M,videoStartTime:A,visible:this.visible,volume:N})})})}}function C(e){let{pinKey:t}=e,i=(0,l.Z)(I,t),{logContextEvent:n}=(0,o.v)(),{checkExperiment:r}=(0,h.F)(),{setVideoPlayed:a}=(0,p.r)(),d=r("web_video_start_log").anyEnabled,s=r("web_metric_video_throttle").anyEnabled;return(0,g.jsx)(b,{...e,isMetricThrottleExpEnabled:s,logContextEvent:n,pin:i,setVideoPlayed:a,shouldLogVideoStart:d})}v(b,"defaultProps",a.nk.defaultProps)}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/92184-3cf1a51396f9ee2a.mjs.map